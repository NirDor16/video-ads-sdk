<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Ads Admin</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h2, h3 { margin-top: 0; }
    input, select, button { padding: 6px; margin: 4px 0; }
    table { border-collapse: collapse; width: 100%; margin-top: 12px; }
    th, td { border: 1px solid #ddd; padding: 8px; font-size: 14px; }
    th { background: #f5f5f5; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: flex-end; }
    .card { border: 1px solid #ddd; padding: 14px; border-radius: 8px; margin-top: 16px; }
    .danger { background: #fff0f0; }
    .small { font-size: 12px; color: #666; }
    pre { background: #111; color: #0f0; padding: 12px; border-radius: 6px; margin-top: 12px; }
  </style>
</head>
<body>

<h2>ğŸ¬ Video Ads Admin</h2>

<div class="card">
  <label><b>App ID:</b></label><br/>
  <input id="appId" value="demo_app" />
  <button onclick="refreshAds()">Load Ads</button>
  <div class="small">× ×™×”×•×œ ×¤×¨×¡×•××•×ª ×œ×¤×™ ××¤×œ×™×§×¦×™×”</div>
</div>

<div class="card">
  <h3>â• Upload New Ad</h3>

  <div class="row">
    <div>
      <label>Category:</label><br/>
      <select id="upCat">
        <option value="TV">TV</option>
        <option value="CAR">CAR</option>
        <option value="GAME">GAME</option>
      </select>
    </div>

    <div>
      <label>Title:</label><br/>
      <input id="upTitle" placeholder="Ad title"/>
    </div>

    <div>
      <label>Ad ID (optional):</label><br/>
      <input id="upAdId" placeholder="ad_custom_001"/>
    </div>

    <div>
      <label>Target URL (optional):</label><br/>
      <input id="upTarget" placeholder="https://example.com"/>
    </div>

    <div>
      <label>Video file:</label><br/>
      <input id="upFile" type="file" accept="video/*"/>
    </div>

    <div>
      <button onclick="uploadVideo()">Upload</button>
    </div>
  </div>
</div>

<div class="card danger">
  <h3>ğŸ“‹ Existing Ads</h3>
  <table>
    <thead>
      <tr>
        <th>Ad ID</th>
        <th>Category</th>
        <th>Title</th>
        <th>Video</th>
        <th>Target</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="adsBody"></tbody>
  </table>
</div>

<pre id="out"></pre>

<script>
const out = t => document.getElementById("out").textContent = t;
const appId = () => document.getElementById("appId").value.trim();

async function refreshAds() {
  const r = await fetch(`/v1/apps/${encodeURIComponent(appId())}/ads`);
  const j = await r.json();

  const body = document.getElementById("adsBody");
  body.innerHTML = "";

  (j.ads || []).forEach(ad => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${ad.ad_id}</td>
      <td>${ad.category_id}</td>
      <td>${ad.title}</td>
      <td>${ad.video_url ? `<a href="${ad.video_url}" target="_blank">open</a>` : ""}</td>
      <td>${ad.target_url ? `<a href="${ad.target_url}" target="_blank">open</a>` : ""}</td>
      <td><button onclick="deleteAd('${ad.ad_id}')">Delete</button></td>
    `;
    body.appendChild(tr);
  });

  out(JSON.stringify(j, null, 2));
}

async function uploadVideo() {
  const file = document.getElementById("upFile").files[0];
  if (!file) {
    alert("Choose a video file");
    return;
  }

  const fd = new FormData();
  fd.append("file", file);
  fd.append("category_id", document.getElementById("upCat").value);
  fd.append("title", document.getElementById("upTitle").value);
  fd.append("ad_id", document.getElementById("upAdId").value);
  fd.append("target_url", document.getElementById("upTarget").value);

  const r = await fetch(`/v1/apps/${encodeURIComponent(appId())}/ads/upload`, {
    method: "POST",
    body: fd
  });

  const j = await r.json();
  out(JSON.stringify(j, null, 2));
  refreshAds();
}

async function deleteAd(adId) {
  if (!confirm(`Delete ad ${adId}?`)) return;

  const r = await fetch(`/v1/apps/${encodeURIComponent(appId())}/ads/${encodeURIComponent(adId)}`, {
    method: "DELETE"
  });
  const j = await r.json();
  out(JSON.stringify(j, null, 2));
  refreshAds();
}
</script>

</body>
</html>
